#!/bin/sh

if [ -f "$HOME/.cache/openvpnpid" ]; then
  rm ~/.cache/openvpnpid
  sudo killall -SIGINT openvpn
  exit
fi

if [ ! -f "$HOME/.config/ovpn/conf.ovpn" ]; then
  notify-send "ğŸ” OpenVPN" "Can't start VPN. Configuration file is missing"
  exit
fi

sudo openvpn "$HOME/.config/ovpn/conf.ovpn" &
PID=$!
notify-send "ğŸ” OpenVPN" "VPN is being initialized"
echo $PID > ~/.cache/openvpnpid
killall -40 waybar
wait $PID
notify-send "ğŸ” OpenVPN" "VPN service has stopped with exit code $?"
rm -f ~/.cache/openvpnpid
killall -40 waybar
