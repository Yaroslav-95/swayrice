#!/bin/sh

# menu prompt to open a link with mimeo

# Source settings from .bemenurc
. ~/.config/bemenurc

searchurl="https://srx.yaroslavps.com/search?q="
histf="$HOME/.config/vimb/history"

# Have to use this "hack" because bemenu doesn't know how to paste
if [ "$1" = "paste" ]; then
	prompt="$(wl-paste)"
else
	prompt="$(cat "$histf")"
fi

choice=$(printf "%s" "$prompt" | bemenu -i -l 25 -p "Enter link or query:" --tf="$BEMENU_TF" --tb="$BEMENU_NB" --fb="$BEMENU_NB" --fn="$BEMENU_FN" --nb="$BEMENU_NB" --nf="$BEMENU_NF" --hf="$BEMENU_HF" --hb="$BEMENU_HB" --monitor="$BEMENU_MONITOR") || exit 1

if echo "$choice" | egrep ".*://.*" >/dev/null 2>&1; then
	choice="$(echo "$choice" | cut -f 1)"
	mimeo "$choice"
else
	$BROWSER "$choice"
fi

